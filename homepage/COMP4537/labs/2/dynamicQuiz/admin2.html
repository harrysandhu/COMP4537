<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sarah Esla</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

</head>
<body>
<script>
 
    document.addEventListener("DOMContentLoaded", function(event) {
        let addBtn = H._(document, "#add-question");
        addBtn.addEventListener("click", Question.handleRender(H.genid()))
        let qm = new QuestionManager();
        qm.render()
    })

    let active_questions = 0
    class QuestionManager{
        constructor(){
            this.qlist = JSON.parse(localStorage.getItem("qlist"));
        }

        render(){
            for(let id in this.qlist){
                Question.render(id, true)
            }
        }

        count(){
            let count = 0;
            for(let prop in this.qlist){
                if(this.qlist.hasOwnProperty(prop))
                    count++
            }
            return count;
        }
    }

    class Question{
        constructor(id, question, options, answer){
            this.id = id;
            this.question = question;
            this.options = options;
            this.answer = answer;
        }
        
        static parse(json_str){
            let o = JSON.parse(json_str);
            return new Question(o.id, o.question, o.options, o.answer)
        }

        static handleRender(qid){
            return function(){
             active_questions += 1
               Question.render(qid, false)
            }
        }    

        static render(qid, exists){
            let qm = new QuestionManager();

            let template = H._(document, "#new-question");
            const c = document.importNode(template.content, true);

            // ------- identify by qids ----------
            H._(c, ".container").id = "container-" + qid;
            H._(c, ".box").id = "box-" + qid
            for(let i = 0; i < 4; i++){
                H._(c, ".input-"+i).name = "input-" + qid;
                H._(c, ".radio-"+i).name = "radio-" + qid;
            }
            H._(c, ".submit").id = "submit-" + qid;
            // -----------------------------------
            H._(c, ".title").textContent = "Question " + Number(qm.count()+ active_questions);
            H._(c, ".submit").addEventListener("click", Question.save(qid))
            document.body.appendChild(c)
            if(exists){
             
                let data = qm.qlist[qid];
                console.log(data)
                H._(document, "#box-"+qid).value = data.question
                let radios = H.n("radio-"+qid)
                let inputs = H.n("input-"+qid)

                for(let i = 0; i < 4; i++){
                    inputs[i].value = data.options[i]
                    if(data.options[i] == data.answer){
                        radios[i].checked = true
                    }
                }
            }
        }



        static sv(id){
            return function(){
                let text_content = H._(document, "#input-" + id).value;
                console.log(text_content)
            }
        }

        static save(id){
            return function(){
                let question = H._(document, "#box-"+id).value;
                let radios = H.n("radio-"+id)
                let inputs = H.n("input-"+id) 
                console.log(radios)
                let answer = null
                let input_values = []

                for(let i = 0; i < 4; i++){
                    if(radios[i].checked){
                        answer = inputs[i].value;
                    }
                    input_values.push(inputs[i].value);
                }
                let q = new Question(id, question, input_values, answer);
                console.log(q)
                let qm = new QuestionManager()
                qm.qlist[id] = q
                console.log("new list", qm.qlist)
                localStorage.setItem("qlist", JSON.stringify(qm.qlist));
            }
        }
    }

    class H{
        static genid(){
            let r = Math.random().toString(36).substring(7);
            return r
        }

        static _(node, identifier){
            return node.querySelector(identifier);
        }

        static n(name){
            return document.getElementsByName(name);
        }

    }
    




</script>
    <h1>Add Some Questions</h1>
    <button id="add-question">Add Question</button>
    <br><br>


    <template id="new-question">
        <div class="container">
            <h3 class="title"></h3>
            <textarea class="box"></textarea>
            <br/>
            <input type="radio" name="" class="radio-0" value="" checked/>
            <input type="text" class="input-0" />
            <br/>
            <input type="radio" name="" class="radio-1" value="" />
            <input type="text" class="input-1" />
            <br/>
            <input type="radio" name="" class="radio-2"  value="" />
            <input type="text" class="input-2" />
            <br/>
            <input type="radio" name="" class="radio-3" value="" />
            <input type="text" class="input-3" />
            <br/>
             <button class="submit">Save Question</button>
        </div>
    </template>


</body>
</html>
